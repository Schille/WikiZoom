<html>
	<head>
		<script src="dependencies/raphael-min.js" type="text/javascript"></script>
		<script src="dependencies/mootools-core-1.4.5.js" type="text/javascript"></script>
		<script src="dependencies/mootools-more-1.4.0.1.js" type="text/javascript"></script>
		<script src="vertex.js" type="text/javascript"></script>
		<script src="ZoomCore.js" type="text/javascript"></script>
		<script src="ZoomUI.js" type="text/javascript"></script>
		<script src="WikiFetcher.js" type="text/javascript"></script>
		<script src="Settings.js"></script>

		<style type="text/css">
			/* Style sheet tooltip */
			/* Gesamtbreite für den Tooltip definieren */
			.tool {
				width: 500px;
			}

			/* Definitionen für den Tooltip-Titel definieren */
			.tool .tip-title {
				margin: 0 0 10px 0;
				padding: 10px 20px;
				font-family: verdana, arial, sans-serif;
				font-weight: bold;
				font-size: 1.2em;
				color: #fff;
				background: #666;
				/* Gecko-Browser (Firefox) */
				-moz-box-shadow: 2px 2px 8px #999;
				/* Webkit-Browser (Safari, Chrome) */
				-webkit-box-shadow: 2px 2px 8px #999;
				/* allgemein CSS3 */
				box-shadow: 2px 2px 8px #999;
			}

			/* Definitionen für den Tooltip-Beschreibungstext definieren */
			.tool .tip-text {
				margin: 0;
				padding: 10px 20px;
				font-family: verdana, arial, sans-serif;
				font-size: 1.1em;
				line-height: 1.7;
				background: #fff;
				/* Gecko-Browser (Firefox) */
				-moz-box-shadow: 2px 2px 8px #999;
				/* Webkit-Browser (Safari, Chrome) */
				-webkit-box-shadow: 2px 2px 8px #999;
				/* allgemein CSS3 */
				box-shadow: 2px 2px 8px #999;
			}
		</style>

	</head>

	<body>
		<script type="text/javascript">
			//Creates canvas 320 × 200 at 10, 50
			

			
			var paper_width = (window.innerWidth - window.innerWidth / 10);
			var paper_height = (window.innerHeight - window.innerHeight / 10);
			var paper = Raphael(0, 0, paper_width, paper_height);
			var vertex_mom = new vertex("Chaostheorie", "Some nice things about this", "http://wikipedia.org", 0);
			var vertex_child1 = new vertex("Shits", "Some things about shit", "http://wikipedia.org/shits", 1,vertex_mom);
			vertex_mom.children.push(vertex_child1);
			
			paths = paper.set();
			
			function createEdge(vertexChild) {
			
				var xP = vertexChild.parent.svg[0].attr("cx");
				var yP = vertexChild.parent.svg[0].attr("cy");
				var xC = vertexChild.svg[0].attr("cx");
				var yC = vertexChild.svg[0].attr("cy");
				var startColor = vertexChild.parent.svg[0].attr("fill");
				var endColor = vertexChild.parent.svg[0].attr("fill");
				var colorAngle = Math.floor(Raphael.angle(xP, yP, xC, yC));
				console.log(xC + " " + yC);

				if (colorAngle > 90 && colorAngle < 270)
					if (colorAngle > 180)
						colorAngle = colorAngle - 90 + 180;
					else
						colorAngle = colorAngle - 90;
				else if (colorAngle > 180)
					colorAngle = colorAngle + 90 + 180;
				else
					colorAngle = colorAngle + 90;

				if (xP <= xC && yP <= yC) {
					var path = paper.path("M" + (xP - 10) + "," + yP + " L" + xC + "," + (yC + 3) + " L" + xP + "," + (yP - 10));
					path.animate({
						'fill' : colorAngle + '-' + startColor + '-' + endColor + '',
						"stroke" : "none",
					},1000,"linear").toBack();
					paths.push(path);
				}
				if (xP >= xC && yP <= yC) {
					var path = paper.path("M" + xP + "," + (yP - 10) + " L" + xC + "," + (yC + 3) + " L" + (xP + 10) + "," + yP);
					path.animate({
						'fill' : colorAngle + '-' + startColor + '-' + endColor + '',
						"stroke" : "none",
						},1000,"linear").toBack();
						paths.push(path);
				}
				if (xP >= xC && yP >= yC) {
					var path = paper.path("M" + xP + "," + (yP + 10) + " L" + xC + "," + (yC - 3) + " L" + (xP + 10) + "," + yP);
					path.animate({
						'fill' : colorAngle + '-' + startColor + '-' + endColor + '',
						"stroke" : "none",
						},1000,"linear").toBack();
						paths.push(path);
						

				}
				if (xP <= xC && yP >= yC) {
					var path = paper.path("M" + (xP - 10) + "," + yP + " L" + xC + "," + (yC - 3) + " L" + xP + "," + (yP + 10));
					path.animate({
						'fill' : colorAngle + '-' + startColor + '-' + endColor + '',
						"stroke" : "none",
						},1000,"linear").toBack();
						paths.push(path);
				}
			
				
				
				console.log("Pfade " + paths.length);
				

			};

			function shadeColor(color, percent) {
				var num = parseInt(color.slice(1), 16), amt = Math.round(2.55 * percent), R = (num >> 16) + amt, B = (num >> 8 & 0x00FF) + amt, G = (num & 0x0000FF) + amt;
				return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + (B < 255 ? B < 1 ? 0 : B : 255) * 0x100 + (G < 255 ? G < 1 ? 0 : G : 255)).toString(16).slice(1);
			}

			function displayChildNodes(myNode, x, y) {
				var level_fac = (Math.pow(0.7, myNode.level));
				
				var child_count = myNode.children.length;
				
				var angle_steps = Math.PI * 2 / child_count;
				var angle = angle_steps;
				

				if (child_count > 1) {
					
					paths.forEach(function(e) {
						e.remove();
					});
							
					for ( i = 0; i < child_count - 1; i++) {

						moveNode(myNode.children[i], (200 * level_fac * Math.cos(angle) + x), (200 * level_fac * Math.sin(angle) + y))

						myNode.children[i].svg.attr({
							"cx" : (200 * level_fac * Math.cos(angle) + x),
							"cy" : (200 * level_fac * Math.sin(angle) + y),
							"x" : (200 * level_fac * Math.cos(angle) + x),
							"y" : (200 * level_fac * Math.sin(angle) + y)
						});
						
						createEdge(myNode.children[i]);
						
						
						
						angle = angle_steps + angle;
					}
					
					
					

				}

				var vertex_to_paint = paintNode(myNode.children[child_count - 1], (200 * level_fac * Math.cos(angle) + x), (200 * level_fac * Math.sin(angle) + y), myNode)

				return vertex_to_paint;

			}

			function moveNode(myNode, mx, my) {
				var gnupsi1 = myNode.svg;

				gnupsi1.forEach(function(element) {
					if (element.attr("text") != undefined) {
						var move1 = element.animate({
							"x" : mx,
							"y" : my
						}, 5000, "backOut");
					} else {
						element.animate({
							"cx" : mx,
							"cy" : my
						}, 5000, "backOut");
					}

				});

			}

			function paintNode(myNode, x, y) {
				var level_fac = (Math.pow(0.7, myNode.level));
				var size = 50 * level_fac;
				var fontsize = 20 * level_fac;

				paper.setStart();
				var circle1 = paper.circle(x, y, 0);

				circle1.attr({
					"fill" : "#CCCCCC",
					"fill-opacity" : 1,
					"stroke" : '#AAAAAA',
					"stroke-width" : 2,
				});
				var circle11 = paper.circle(x, y, 0);
				circle11.attr({
					"stroke" : '#AAAAAA',
					"stroke-dasharray" : "- ",
					"stroke-width" : 2,
					"stroke-linecap" : "round",
				});

				var text1 = paper.text(x, y, myNode.title).toFront();
				text1.attr({
					"font-size" : 0,
					"font-family" : "Cabin",
					"fill" : '#555555',
				});
				var set3 = paper.setFinish();

				circle1.attr({
					"fill" : shadeColor("#CCCCCC", (1 - level_fac) * 35),
					"stroke" : shadeColor("#AAAAAA", (1 - level_fac) * 50)
				});
				circle11.attr({
					"stroke" : shadeColor("#AAAAAA", (1 - level_fac) * 50)
				});
				text1.attr({
					"fill" : shadeColor("#555555", (1 - level_fac) * 80)
				});

				var an1 = circle1.animate({
					"r" : size
				}, 2000, "elastic");
				circle11.animateWith(circle1, an1, {
					"r" : (size - 4)
				}, 2000, "elastic");
				text1.animateWith(circle1, an1, {
					"font-size" : fontsize
				}, 2000, "elastic");

				myNode.svg = set3;

				var over = function(event) {
					set3.animate({
						transform : "s1.1"
					}, 2000, "elastic");

				};

				var out = function(event) {
					set3.animate({
						transform : "s1"
					}, 2000, "elastic");
				};

				set3.mouseover(over);
				set3.mouseout(out);
				
				if(myNode.parent != null) {
					createEdge(myNode);
				}

				return myNode;
			};

			vertext_mom = paintNode(vertex_mom, paper_width / 2, paper_height / 2, null, null);
			vertex_child1 = displayChildNodes(vertex_mom, vertex_mom.svg[0].attr("cx"), vertex_mom.svg[0].attr("cy"));
			//moveNode(vertex_child1, 200, 200);
			
			var vertex_child2 = new vertex("Hass", "Some things about hass", "http://wikipedia.org/hass", 1,vertex_mom);
			vertex_mom.children.push(vertex_child2);
			vertex_child2 = displayChildNodes(vertex_mom, vertex_mom.svg[0].attr("cx"), vertex_mom.svg[0].attr("cy"));
			

			var vertex_child3 = new vertex("Liebe", "Some things about hass", "http://wikipedia.org/hass", 1,vertex_mom);
			vertex_mom.children.push(vertex_child3);
			vertex_child3 = displayChildNodes(vertex_mom, vertex_mom.svg[0].attr("cx"), vertex_mom.svg[0].attr("cy"));
			

			var vertex_child4 = new vertex("Ahhhh", "Some things about hass", "http://wikipedia.org/hass", 1,vertex_mom);
			vertex_mom.children.push(vertex_child4);
			vertex_child4 = displayChildNodes(vertex_mom, vertex_mom.svg[0].attr("cx"), vertex_mom.svg[0].attr("cy"));
			

			var vertex_child5 = new vertex("Mies", "Some things about hass", "http://wikipedia.org/hass", 1,vertex_mom);
			vertex_mom.children.push(vertex_child5);
			vertex_child5 = displayChildNodes(vertex_mom, vertex_mom.svg[0].attr("cx"), vertex_mom.svg[0].attr("cy"));
			
			

			var vertex_child11 = new vertex("Poop", "Some things about poop", "http://wikipedia.org/poop", 2,vertex_child1);
			vertex_child1.children.push(vertex_child11);
			vertex_child11 = displayChildNodes(vertex_child1, vertex_child1.svg[0].attr("cx"), vertex_child1.svg[0].attr("cy"));
			
		</script>
		<script>
			var fetchTest = "Mannheim";
			fetch(fetchTest);
		</script>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>

	</body>

</html>