<html>
	<head>
		<script src="dependencies/raphael-min.js" type="text/javascript"></script>
		<script src="dependencies/mootools-core-1.4.5.js" type="text/javascript"></script>
		<script src="dependencies/mootools-more-1.4.0.1.js" type="text/javascript"></script>
		<script src="vertex.js" type="text/javascript"></script>
		<script src="ZoomCore.js" type="text/javascript"></script>
		<script src="ZoomUI.js" type="text/javascript"></script>
		<script src="WikiFetcher.js" type="text/javascript"></script>
		<script src="Settings.js"></script>

		<style type="text/css">
			/* Style sheet tooltip */
			/* Gesamtbreite für den Tooltip definieren */
			.tool {
				width: 500px;
			}

			/* Definitionen für den Tooltip-Titel definieren */
			.tool .tip-title {
				margin: 0 0 10px 0;
				padding: 10px 20px;
				font-family: verdana, arial, sans-serif;
				font-weight: bold;
				font-size: 1.2em;
				color: #fff;
				background: #666;
				/* Gecko-Browser (Firefox) */
				-moz-box-shadow: 2px 2px 8px #999;
				/* Webkit-Browser (Safari, Chrome) */
				-webkit-box-shadow: 2px 2px 8px #999;
				/* allgemein CSS3 */
				box-shadow: 2px 2px 8px #999;
			}

			/* Definitionen für den Tooltip-Beschreibungstext definieren */
			.tool .tip-text {
				margin: 0;
				padding: 10px 20px;
				font-family: verdana, arial, sans-serif;
				font-size: 1.1em;
				line-height: 1.7;
				background: #fff;
				/* Gecko-Browser (Firefox) */
				-moz-box-shadow: 2px 2px 8px #999;
				/* Webkit-Browser (Safari, Chrome) */
				-webkit-box-shadow: 2px 2px 8px #999;
				/* allgemein CSS3 */
				box-shadow: 2px 2px 8px #999;
			}
		</style>

	</head>

	<body>
		<script type="text/javascript">
			//Creates canvas 320 × 200 at 10, 50
			var paper_width = (window.innerWidth - window.innerWidth / 10);
			var paper_height = (window.innerHeight - window.innerHeight / 10);
			var paper = Raphael(0, 0, paper_width, paper_height);
			var vertex_mom = new vertex("Chaostheorie", "Some nice things about this", "http://wikipedia.org", 0);
			var vertex_child1 = new vertex("Shits", "Some things about shit", "http://wikipedia.org/shits", 1);
			vertex_mom.children.push(vertex_child1);
			var vertex_child11 = new vertex("Poop", "Some things about poop", "http://wikipedia.org/poop", 2);
			vertex_child1.children.push(vertex_child11);

			function createEdge(vertexParent, vertexChild) {
				
				
				var xP = vertexParent.svg[0].attr("cx");
				var yP = vertexParent.svg[0].attr("cy");
				var xC = vertexChild.svg[0].attr("cx");
				var yC = vertexChild.svg[0].attr("cy");
				var startColor = vertexParent.svg[0].attr("fill");
				var endColor = vertexChild.svg[0].attr("fill");
				var colorAngle = Math.floor(Raphael.angle(xP,yP,xC,yC));
				console.log(startColor+" "+endColor);
				
				endColor = "black";
				startColor = "white";
				
				// if(colorAngle<180)
					// colorAngle = colorAngle +180;
				 console.log(colorAngle);
				
				if(xP < xC && yP < yC) {
					var path = paper.path("M"+(xP-10)+","+yP+" L"+xC+","+(yC+3)+" L"+xP+","+(yP-10));
					path.attr({'fill': colorAngle+'-'+endColor+':0-'+startColor+':100', "stroke":"none"});
				}
				if(xP > xC && yP < yC) {
					var path = paper.path("M"+xP+","+(yP-10)+" L"+xC+","+(yC+3)+" L"+(xP+10)+","+yP);
					path.attr({'fill': colorAngle+'-'+endColor+':0-'+startColor+':100', "stroke":"none"});
				}
				if(xP > xC && yP > yC) {
					var path = paper.path("M"+xP+","+(yP+10)+" L"+xC+","+(yC-3)+" L"+(xP+10)+","+yP);
					path.attr({'fill': colorAngle+'-'+endColor+':0-'+startColor+':100', "stroke":"none"});
				
				}
				if(xP < xC && yP > yC) {
					var path = paper.path("M"+(xP-10)+","+yP+" L"+xC+","+(yC-3)+" L"+xP+","+(yP+10));
					path.attr({'fill': colorAngle+'-'+endColor+':0-'+startColor+':100', "stroke":"none"});
				}
			
			};

			

			function shadeColor(color, percent) {
				var num = parseInt(color.slice(1), 16), amt = Math.round(2.55 * percent), R = (num >> 16) + amt, B = (num >> 8 & 0x00FF) + amt, G = (num & 0x0000FF) + amt;
				return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + (B < 255 ? B < 1 ? 0 : B : 255) * 0x100 + (G < 255 ? G < 1 ? 0 : G : 255)).toString(16).slice(1);
			}

			function paintNode(myNode, x, y) {
				var level_fac = (Math.pow(0.7, myNode.level));
				var size = 50 * level_fac;
				var fontsize = 20 * level_fac;

				paper.setStart();
				var circle1 = paper.circle(x, y, 0);

				circle1.attr({
					"fill" : "#CCCCCC",
					"fill-opacity" : 1,
					"stroke" : '#AAAAAA',
					"stroke-width" : 2,
				});
				var circle11 = paper.circle(x, y, 0);
				circle11.attr({
					"stroke" : '#AAAAAA',
					"stroke-dasharray" : "- ",
					"stroke-width" : 2,
					"stroke-linecap" : "round",
				});

				var text1 = paper.text(x, y, myNode.title).toFront();
				text1.attr({
					"font-size" : 0,
					"font-family" : "Cabin",
					"fill" : '#555555',
				});
				var set3 = paper.setFinish();

				circle1.attr({
					"fill" : shadeColor("#CCCCCC", (1 - level_fac) * 35),
					"stroke" : shadeColor("#AAAAAA", (1 - level_fac) * 50)
				});
				circle11.attr({
					"stroke" : shadeColor("#AAAAAA", (1 - level_fac) * 50)
				});
				text1.attr({
					"fill" : shadeColor("#555555", (1 - level_fac) * 80)
				});

				var an1 = circle1.animate({
					"r" : size
				}, 2000, "elastic");
				circle11.animateWith(circle1, an1, {
					"r" : (size - 4)
				}, 2000, "elastic");
				text1.animateWith(circle1, an1, {
					"font-size" : fontsize
				}, 2000, "elastic");

				myNode.svg = set3;

				var over = function(event) {
					set3.animate({
						transform : "s1.1"
					}, 2000, "elastic");

				};

				var out = function(event) {
					set3.animate({
						transform : "s1"
					}, 2000, "elastic");
				};

				set3.mouseover(over);
				set3.mouseout(out);

				return myNode;
			};

			vertext_mom = paintNode(vertex_mom, 300, 200,null);
			vertex_child1 = paintNode(vertex_mom.children[0],400,10,vertex_mom);
			vertex_child11 = paintNode(vertex_child1.children[0], 150, 20,vertex_child1);
			createEdge(vertex_mom,vertex_child1);
			createEdge(vertex_child1,vertex_child11);
		</script>
		<script>
			var fetchTest = "Mannheim";
			fetch(fetchTest);
		</script>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>

	</body>

</html>